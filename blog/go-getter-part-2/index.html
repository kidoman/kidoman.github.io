<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>Go Getter Part 2 | Karan Misra</title>

  
  <link rel="stylesheet" href="http://kidoman.io//css/poole.css">
  <link rel="stylesheet" href="http://kidoman.io//css/hyde.css">
  <link rel="stylesheet" href="http://kidoman.io//css/poole-overrides.css">
  <link rel="stylesheet" href="http://kidoman.io//css/hyde-overrides.css">
  <link rel="stylesheet" href="http://kidoman.io//css/hyde-x.css">
  <link rel="stylesheet" href="http://kidoman.io//css/highlight/sunburst.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
  <link href="/favicon.png" rel="icon">

  
  <link href="" rel="alternate" type="application/rss+xml" title="Coder, Biker, Gamer | Karan Misra" />

  <meta name="description" content="Now with C&#43;&#43; optimizations.">
  <meta name="keywords" content="kidoman,embd,sostronk">
  <link rel="author" href="http://plus.google.com/109365517985703707273">
</head>
<body class="theme-base-0f">
<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <a href="http://kidoman.io//"><img src="http://www.gravatar.com/avatar/8aea1ec57a05b988585f7f2c9e320cfe?s=200" alt="gravatar"></a>
      <h1>Karan Misra</h1>
      <p class="lead"><p>Coder, Biker, Gamer</p>

<p>Co-Founder, CTO @<br/>
  <a href="https://www.sostronk.com/">SoStronk</a></p>
</p>
    </div>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item"><a href="http://kidoman.io//">Blog</a></li>
      
      <li class="sidebar-nav-item"><a href="mailto:kidoman@gmail.com">Contact</a></li>
      
      <li class="sidebar-nav-item"><a href="/about/">About</a></li>
      
    </ul>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item"><a href="https://github.com/kidoman">GitHub</a></li>
      
      
      
      <li class="sidebar-nav-item"><a href="https://twitter.com/kidoman_">Twitter</a></li>
    </ul>
  </div>
</div>


<div class="content container">
  <div class="post">
    <h1>Go Getter Part 2</h1>
    <span class="post-date">Oct 3, 2013 &middot; 2 minute read &middot; <a  href="javascript:window.location='http://kidoman.io/blog/go-getter-part-2/#disqus_thread'" data-disqus-url="http://kidoman.io/programming/go-getter-part-2.html"  >Comments</a>

    
    <br/>
    
    <a class="label" href="http://kidoman.io//categories/programming">programming</a>
    </span>
    

<p><strong>*Update:</strong> I have now posted a <a href="/programming/go-getter-part-3.html">second follow up article</a> with the benchmarks rerun with a multi-threaded optimized C++ version</p>

<h2 id="apples-oranges:ec7f7c4d36f75cd2bcf7441ab0438aa1">Apples? Oranges?</h2>

<p>This is a follow up article to the initial <a href="/programming/go-getter.html">Go Getter</a> article which focused purely on optimizing the Go solution. The comparision was not apples-to-apples (and still isn&rsquo;t; as we are talking about two very different platforms here) and was never meant to be. Instead it was focused on:</p>

<ul>
<li>Learn idiomatic Go</li>
<li>Document optimizations which help make the Go solution faster</li>
<li>Fire up all cylinders (erm cores) and see how the performance scales</li>
<li>Discover any avenues of optimizing Go further (after all, we are just at version 1.2rc1)</li>
<li>Fun?</li>
</ul>

<p>It was never meant to mislead people into believing that Go was faster than a fully optimized C++ solution, or to deceive people into adopting Go as a result. Since its been a while (7 years) I went knee deep into C++, I had left it upto more experienced hands to properly optimize the C++ version. Evidently, it was wishful thinking.</p>

<h2 id="full-steam-ahead:ec7f7c4d36f75cd2bcf7441ab0438aa1">Full Steam Ahead</h2>

<p>I spent the last couple of hours applying the optimizations learnt from the Go story to the C++ version: <a href="https://github.com/kidoman/rays/compare/bbb8395aa999883a595267fd0230087b1ddf646c...940c91f601ef840e6d75ddf272ab6cd3eb8d5531">diff of the optimizations</a></p>

<p>Needless to say, the C++ performance is <strong>exciting</strong> again. Mind you, although I tried using OpenMP to bring in some multi-threaded love, it didn&rsquo;t work out so well. So I will truly have to leave that upto more capable hands.</p>

<p>
<figure >
    
        <img src="/images/go-vs-cpp-after-both-optimized.png" alt="Go vs C&#43;&#43; after both are optimized" />
    
    
</figure>
</p>

<p><em>It was compiled by &ldquo;c++ -O3&rdquo; using G++ 4.7.3 and benchmarked on a Core i7 2600 16 GB dedicated Hetzner server running an updated Ubuntu 13.04 installation</em></p>

<h2 id="road-ahead:ec7f7c4d36f75cd2bcf7441ab0438aa1">Road Ahead</h2>

<p>I hope to takes these numbers to the Go community and try and close the gap as much as possible. Go suffers from relatively slower performance because it tries to be as safe as possible when used in a concurrent scenario (for example, the default &ldquo;global rand&rdquo; is synchronized and good to access from multiple goroutines.) That is something I would definitely desire when doing real world coding. There is definitely scope for improvement, but considering everything else (GC, compilation speed, goroutines, channels, etc.) that Go brings to the table, I guess it will always be a game of balance.</p>

<p>As usual, reachable at kidoman@gmail.com / karanm@thoughtworks.com / <a href="https://twitter.com/kid0m4n">@kid0m4n</a></p>

    <p>
      
      <a href="http://www.reddit.com/r/golang/comments/1nlgbq/business_card_ray_tracer_go_faster_than_c/">Reddit Discussion Thread</a>
      
      <br/>
      
      <a href="https://news.ycombinator.com/item?id=6499203">Hacker News Discussion Thread</a>
      
      <br/>
      <a href="javascript:window.location='http://twitter.com/intent/tweet?url='+encodeURIComponent(location.href)+'&text=Go%20Getter%20Part%202&via=kidoman_'">Tweet this</a>
    </p>
  </div>
  <div id="disqus_thread"></div>
</div>


<script type="text/javascript">
var disqus_shortname = "kidoman";
(function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());
</script>



<script type="text/javascript">
    var disqus_shortname = "kidoman";
    
    var disqus_url = "http://kidoman.io/programming/go-getter-part-2.html";
    
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

<script src="http://kidoman.io//js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<script>
  var _gaq=[['_setAccount','UA-44459958-1'],['_trackPageview']];
  (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
  g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
  s.parentNode.insertBefore(g,s)}(document,'script'));
</script>

</body>
</html>
